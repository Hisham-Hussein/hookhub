# Feature Spec: Auto-Discovery of Claude Code Hooks

## Summary

Enable HookHub to automatically discover popular Claude Code hooks from GitHub, reducing curator effort and keeping the catalog fresh. Instead of manually adding every hook to `data/hooks.json`, a curator can click a button to search GitHub for hooks matching a purpose category, review the results, and approve entries into the manifest.

## Problem Statement

The current architecture requires a curator to manually find hook repos on GitHub, determine their purpose category and lifecycle event, and hand-edit `data/hooks.json`. This works at 15-50 hooks but doesn't scale — the curator must actively monitor the Claude Code ecosystem to keep the catalog current. Popular new hooks may go undiscovered for weeks.

## Proposed Solution

Add an auto-discovery pipeline that:

1. Searches the GitHub Search API for repositories matching Claude Code hook patterns (e.g., repos containing `claude_code_hooks.toml`, `.claude/hooks/`, or `settings.json` with hook matchers)
2. Classifies discovered hooks by purpose category and lifecycle event (using repo README content, file patterns, and hook configuration files)
3. Presents results to the curator for review in a simple admin UI
4. Approved hooks are added to `data/hooks.json` automatically

## Architecture Impact

| Aspect | Current (MVP) | With Auto-Discovery |
|--------|---------------|---------------------|
| Data flow | Build-time only (manifest → GitHub API → static props) | Build-time + on-demand discovery (GitHub Search API → curator review → manifest update) |
| Write path | None — read-only site | Curator approval writes to manifest |
| API usage | Repos endpoint only, build-time | + Search endpoint, on-demand |
| Authentication | Optional (GITHUB_TOKEN for rate limits) | Required (Search API needs auth, curator approval needs auth) |
| Runtime calls | None | Discovery is runtime (triggered by curator) |

### New Components

| Component | Layer | Description |
|-----------|-------|-------------|
| `GitHubSearchClient` | Adapters | Calls GitHub Search API (`GET /search/repositories`) with hook-related queries |
| `DiscoverHooks` use case | Application | Orchestrates search → classify → present results |
| `ClassifyHook` service | Domain | Analyzes repo content to infer purposeCategory and lifecycleEvent |
| `ManifestWriter` adapter | Adapters | Writes approved entries back to `data/hooks.json` |
| `DiscoveryPage` | Adapters (UI) | Admin page for curator to trigger discovery and approve/reject results |

### ADR Required

**Runtime API calls for discovery:** This breaks ADR-001 (build-time only). The justification is that discovery is a curator-only action, not a browse-time action. End users still see only static build-time data. The runtime call is in the admin path, not the public path.

## Pipeline to Implement

Since this introduces a **new business requirement** (not covered by existing BR-01 through BR-09), the full charter pipeline applies:

| Step | Artifact | Skill | Action |
|------|----------|-------|--------|
| 1 | `BUSINESS-CASE.md` | `/claude-forge:create-business-cases` | Add BR-10: Auto-discover hooks from GitHub |
| 2 | `STORY-MAP.md` | `/claude-forge:create-story-maps` | Add "Auto-Discover Hooks" activity under Data Pipeline epic |
| 3 | `REQUIREMENTS.md` | `/claude-forge:create-requirements` | Expand new SM-XXX stories into FR-DISC-XX requirements |
| 4 | `USER-STORIES.md` | (generated by create-requirements) | New US-XXX stories with acceptance criteria |
| 5 | `ARCHITECTURE-DOC.md` | `/claude-forge:create-design-docs` | Add new interfaces, ADR for runtime discovery, updated data flow |
| 6 | `ROADMAP.md` | `/claude-forge:create-roadmaps` | Add Phase 7 (or new milestone) |
| 7 | `PHASE-N-PLAN.md` | `/claude-forge:plan-phase-tasks` | Task decomposition with TDD steps |
| 8 | Execute | `/charter-to-superpowers N` | Plan → implement → review → finish |

## Suggested Stories

| Story | Description | Size |
|-------|-------------|------|
| SM-022 | Curator triggers hook discovery search by category | M |
| SM-023 | Discovery results show repo name, stars, description, inferred classification | M |
| SM-024 | Curator approves/rejects discovered hooks | M |
| SM-025 | Approved hooks automatically added to manifest | S |
| SM-026 | Discovery deduplicates against existing manifest entries | S |

## Placement in Roadmap

This feature would be a **new release (R3)** or a **new milestone**, not part of MVP or R2. It depends on:
- MVP's manifest structure and domain types (Phase 1)
- MVP's enrichment pipeline (Phase 1, US-019)
- R2's build resilience (Phase 4, for graceful API failure handling)

Suggested: **Phase 7** under a new **R3** release, after Phase 6 (Text Search) is complete.

## Open Questions

1. **Classification accuracy:** Can we reliably infer purposeCategory and lifecycleEvent from repo content alone, or does the curator need to manually set these?
2. **Search query strategy:** What GitHub search queries best identify Claude Code hooks? Filename patterns (`claude_code_hooks.toml`)? Topic tags? README keywords?
3. **Rate limits:** GitHub Search API has stricter rate limits (30 req/min authenticated). Is this sufficient for discovery batches?
4. **Scope creep risk:** Does auto-discovery lead to community submissions (SM rejected in MVP scope)? Should we keep it curator-only?

## Status

**Proposed** — Not yet in the charter pipeline. This spec captures the feature idea for future prioritization. To proceed, start at Step 1 (BUSINESS-CASE.md amendment).
